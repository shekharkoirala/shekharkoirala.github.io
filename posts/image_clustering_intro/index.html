<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Case study: Automated Image Clustering for E-commerce company | shekhar's Blog</title>
<meta name=keywords content="image,clustering,unsupervised,ml"><meta name=description content="Background In this case study, Artificial Intelligence based system is used to take buisness decisions. The study is based on a e-commerce company which ingest lots of data like images, quarterly reports, invoices, customer feedbacks, customer reviews with images, etc. It would be great if this large amount of data is automatically categorized or grouped together. Previously, a machine learning team in the company had created a model to classify the input data."><meta name=author content="shekhar"><link rel=canonical href=https://shekharkoirala.github.io/posts/image_clustering_intro/><meta name=google-site-verification content="UA-168093774-1"><link crossorigin=anonymous href=/assets/css/stylesheet.fc220c15db4aef0318bbf30adc45d33d4d7c88deff3238b23eb255afdc472ca6.css integrity="sha256-/CIMFdtK7wMYu/MK3EXTPU18iN7/MjiyPrJVr9xHLKY=" rel="preload stylesheet" as=style><link rel=icon href=https://shekharkoirala.github.io/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://shekharkoirala.github.io/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://shekharkoirala.github.io/favicon-32x32.png><link rel=apple-touch-icon href=https://shekharkoirala.github.io/apple-touch-icon.png><link rel=mask-icon href=https://shekharkoirala.github.io/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=en href=https://shekharkoirala.github.io/posts/image_clustering_intro/><noscript><style>#theme-toggle,.top-link{display:none}</style></noscript><script>var doNotTrack=!1;doNotTrack||(function(e,t,n,s,o,i,a){e.GoogleAnalyticsObject=o,e[o]=e[o]||function(){(e[o].q=e[o].q||[]).push(arguments)},e[o].l=1*new Date,i=t.createElement(n),a=t.getElementsByTagName(n)[0],i.async=1,i.src=s,a.parentNode.insertBefore(i,a)}(window,document,"script","https://www.google-analytics.com/analytics.js","ga"),ga("create","UA-168093774-1","auto"),ga("send","pageview"))</script><meta property="og:title" content="Case study: Automated Image Clustering for E-commerce company"><meta property="og:description" content="Background In this case study, Artificial Intelligence based system is used to take buisness decisions. The study is based on a e-commerce company which ingest lots of data like images, quarterly reports, invoices, customer feedbacks, customer reviews with images, etc. It would be great if this large amount of data is automatically categorized or grouped together. Previously, a machine learning team in the company had created a model to classify the input data."><meta property="og:type" content="article"><meta property="og:url" content="https://shekharkoirala.github.io/posts/image_clustering_intro/"><meta property="og:image" content="https://shekharkoirala.github.io/papermod-cover.png"><meta property="article:section" content="posts"><meta property="article:published_time" content="2024-05-04T14:49:57+01:00"><meta property="article:modified_time" content="2024-05-04T14:49:57+01:00"><meta property="og:site_name" content="DumpDocs"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://shekharkoirala.github.io/papermod-cover.png"><meta name=twitter:title content="Case study: Automated Image Clustering for E-commerce company"><meta name=twitter:description content="Background In this case study, Artificial Intelligence based system is used to take buisness decisions. The study is based on a e-commerce company which ingest lots of data like images, quarterly reports, invoices, customer feedbacks, customer reviews with images, etc. It would be great if this large amount of data is automatically categorized or grouped together. Previously, a machine learning team in the company had created a model to classify the input data."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://shekharkoirala.github.io/posts/"},{"@type":"ListItem","position":2,"name":"Case study: Automated Image Clustering for E-commerce company","item":"https://shekharkoirala.github.io/posts/image_clustering_intro/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Case study: Automated Image Clustering for E-commerce company","name":"Case study: Automated Image Clustering for E-commerce company","description":"Background In this case study, Artificial Intelligence based system is used to take buisness decisions. The study is based on a e-commerce company which ingest lots of data like images, quarterly reports, invoices, customer feedbacks, customer reviews with images, etc. It would be great if this large amount of data is automatically categorized or grouped together. Previously, a machine learning team in the company had created a model to classify the input data.","keywords":["image","clustering","unsupervised","ml"],"articleBody":"Background In this case study, Artificial Intelligence based system is used to take buisness decisions. The study is based on a e-commerce company which ingest lots of data like images, quarterly reports, invoices, customer feedbacks, customer reviews with images, etc. It would be great if this large amount of data is automatically categorized or grouped together. Previously, a machine learning team in the company had created a model to classify the input data. But the nature of the e-commerce data, new product launches, new customer feedbacks, etc. are not predictable. Thus, the model needs to be retrained frequently. The company is looking for a solution that can automatically perform and help the analyst to get the insight from the unstructured data.\nImage Clustering Lets dive in the Technical side of the case study. There are multiple paradigms of supervised machine learning, such as classification, object detection, and segmentation, among others. There are many robust supervised algorithms; however, to achieve high accuracy, we need labeled data, which is costly and time-consuming. Clustering is an unsupervised learning technique that can be applied to unlabeled datasets. It is one of the most interesting and challenging problems in the field of computer vision. The goal of image clustering is to group similar images together in the same cluster. There are also other forms of machine learning, such as semi-supervised learning, reinforcement learning, and transfer learning, which are not covered in this article. The main goal of the article is to explore the image clustering technique beyond its traditional use cases.\nImage clustering: View from Professional settings In real world scenario, a company could ingest images from multiple sources. The image sizes / format , interest point in the image are unknown. To fetch the insight from the unstructure settings is really hard and requires alot of regular hand picked tuning. Thus, Many companies moves towards supervised learning where they sample the data and label them and train a supervised model to get the insight.\nHowever, the unsupervised learning is also a good choice when the data is unpredictable and the labels are not available. The image clustering is one of the unsupervised learning technique which can be used to cluster the images based on the similarity and thus using this in the automated workflow to get the insight from the unstructured data.\nMethodology Image clustering systems can be divided into two main categories:\nImage feature Generation Image pixels are stored as matrics in the computer. The size of image matrics varies based on the image size and format. Thus Image pixel couldnot be used directly to custering algorithm due to its size and variability. Image features can be generated using various methods like neural networks, computer vision algorithms like SIFT, SURF, ORB, etc. Sometimes feature reduction techniques like PCA, LDA, etc are used to reduce the dimensionality of the features. Feature clustering After a feature is generated, the clustering algorithm is applied to the features to cluster the images. The clustering algorithm can be K-means, DBSCAN, Hierarchical clustering, etc. for the sake of this study, we are using a small dataset of brand logos. However in the study properitery e-commerce data [ logos from pdfs/ document ] are used. Note: It really depends on the company data, sometimes the whole image are used to generate the features and sometimes the interest points are used to generate the features. Segment Anything model can be used to generate the interest points. Here, an invoice is parsed by the model when the text prompt is logo and the bounding box over the Tesla logo is generated.\nModel Web Demo: Segment Anything\nImage Feature Generation The latest trend of Attention based models outperforms the traditional computer vision algorithms. The attention based models like ViT, ResNet, EfficientNet, etc are used to generate the features. Likewise, there are multi model models like CLIP, DALL-E, etc which are used to generate the features. Using the multi model models, the features can be used to compared with the possible text data and thus can be used to generate the insight from the images.\nfor the example of the image clustering, we will be using the openAI‚Äôs CLIP model to generate the features.\n1 2 3 4 from transformers import AutoProcessor, AutoTokenizer, CLIPModel model = CLIPModel.from_pretrained(\"openai/clip-vit-large-patch14\") processor = AutoProcessor.from_pretrained(\"openai/clip-vit-large-patch14\") a good alternative to the CLIP model is the VIT model.\n1 2 3 4 from transformers import ViTImageProcessor, ViTForImageClassification processor = ViTImageProcessor.from_pretrained('google/vit-base-patch16-224') model = ViTForImageClassification.from_pretrained('google/vit-base-patch16-224') Resource to browse the models for feature generation: Huggingface\nOnce the model is loaded, we can generate the features using the model.\n1 2 3 with torch.no_grad(): inputs = processor(images=batch_images, return_tensors=\"pt\") image_feature_data = model.get_image_features(**inputs) It is important that the processor should be feed in the batch image data. since the the underlying model is trained on the batch image data. Thus batch image helps to achieve better throughput for generating the features.\nImage clustering Algorithm Once the features are generated, the clustering algorithm is applied to the features. The clustering algorithm can be K-means, DBSCAN, Hierarchical clustering, etc. Here, we choose Faiss for the clustering as it has both CPU and GPU support.\n1 2 3 4 5 6 7 8 import faiss n_centroids = 5 # number of clusters n_iter = 100 # number of iterations verbose = True feature_data_dim = feature_data.shape[1] # dimension of the feature data kmeans = faiss.Kmeans(feature_data_dim, ncentroids, niter=niter, verbose=verbose) kmeans.train(feature_data) Lets see How it creates the cluster. The image clustering result doesnot make sense. lets update the hyperparamter and create the clustering again with different number of clusters.\n1 n_centroids = 35 # number of clusters The clustering result is much better. The cluster result is better than the previous as we increased the number of clusters. The number of clusters can be determined based on the domain knowledge of the dataset or using the metrics.\nImage clustering Metrics Finding the best cluster size is a challengine task. The perfect cluster size can be predicted if some domain knowledge of the dataset is available. In the absence of domain knowledge, we can use the metrics to find the best cluster size.\nImage clustering can be compared based on two types of metrics.\nExtrinsic metrics: Extrinsic metrics are based on the ground truth labels. Some of the popular extrinsic metrics are: Adjusted Rand Index (ARI) Normalized Mutual Information (NMI) Fowlkes-Mallows Index (FMI) Homogeneity, Completeness, and V-measure Precision, Recall, and F1-score Confusion matrix However, we are into the unsupervised learning, we will not be using these metrics.\nIntrinsic metrics: Intrinsic metrics are based on the clustering results. Some of the popular intrinsic metrics are: Silhouette score Davies-Bouldin Index Calinski-Harabasz Index Gap statistic Elbow method Lets see how we can use these metrics to evaluate the clustering results.\nelbow method is used to find the best cluster size.\nThe elbow method is used to find the best cluster size. The best cluster size is the point where the curve starts to flatten. In the above image, the best cluster size is 35/40.\nSimilarly, other metrics can be used to evaluate the clustering results.\nThe blog only highlights the specfic part of the image clustering system. All the necessary code snippets are provided to get started with the image clustering. Many software enhancement and glue code are skipped for the sake of the article.\nResult A image clustering system is created and implemented in the system and the data is forwarded to the analyst for the further analysis. The system is able to cluster the data based on the cluster and thus necessary action can be taken much faster. As the system is automated, many documents gets labelled eventually and thus labelling the cluster is much easier than labelling the whole dataset.\n","wordCount":"1286","inLanguage":"en","image":"https://shekharkoirala.github.io/papermod-cover.png","datePublished":"2024-05-04T14:49:57+01:00","dateModified":"2024-05-04T14:49:57+01:00","author":{"@type":"Person","name":"shekhar"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://shekharkoirala.github.io/posts/image_clustering_intro/"},"publisher":{"@type":"Organization","name":"shekhar's Blog","logo":{"@type":"ImageObject","url":"https://shekharkoirala.github.io/favicon.ico"}}}</script></head><body class=dark id=top><script>localStorage.getItem("pref-theme")==="light"&&document.body.classList.remove("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://shekharkoirala.github.io/ accesskey=h title="shekhar's Blog (Alt + H)">shekhar's Blog</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://shekharkoirala.github.io/archives title="Post üìù"><span>Post üìù</span></a></li><li><a href=https://shekharkoirala.github.io/categories/ title="Categories üîñ"><span>Categories üîñ</span></a></li><li><a href=https://shekharkoirala.github.io/tags/ title="Tags üè∑Ô∏è"><span>Tags üè∑Ô∏è</span></a></li><li><a href=https://shekharkoirala.github.io/about title="About üßò"><span>About üßò</span></a></li><li><a href=https://shekharkoirala.github.io/search/ title=üîç><span>üîç</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://shekharkoirala.github.io/>Home</a>&nbsp;¬ª&nbsp;<a href=https://shekharkoirala.github.io/posts/>Posts</a></div><h1 class="post-title entry-hint-parent">Case study: Automated Image Clustering for E-commerce company</h1><div class=post-meta><span title='2024-05-04 14:49:57 +0100 IST'>May 4, 2024</span>&nbsp;¬∑&nbsp;7 min&nbsp;¬∑&nbsp;shekhar&nbsp;|&nbsp;<a href=mailto:shekharkoirala4@gmail.com rel="noopener noreferrer" target=_blank>Suggest Changes</a></div></header><div class=toc><details open><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><ul><li><a href=#background aria-label=Background>Background</a></li><li><a href=#image-clustering aria-label="Image Clustering">Image Clustering</a><ul><li><a href=#image-clustering--view-from-professional-settings aria-label="Image clustering:  View from Professional settings">Image clustering: View from Professional settings</a></li><li><a href=#methodology aria-label=Methodology>Methodology</a></li><li><a href=#image-feature-generation aria-label="Image Feature Generation">Image Feature Generation</a></li><li><a href=#image-clustering-algorithm aria-label="Image clustering Algorithm">Image clustering Algorithm</a></li><li><a href=#image-clustering-metrics aria-label="Image clustering Metrics">Image clustering Metrics</a></li></ul></li><li><a href=#result aria-label=Result>Result</a></li></ul></div></details></div><div class=post-content><h1 id=background>Background<a hidden class=anchor aria-hidden=true href=#background>#</a></h1><p>In this case study, Artificial Intelligence based system is used to take buisness decisions. The study is based on a e-commerce company which ingest lots of data like images, quarterly reports, invoices, customer feedbacks, customer reviews with images, etc. It would be great if this large amount of data is automatically categorized or grouped together. Previously, a machine learning team in the company had created a model to classify the input data. But the nature of the e-commerce data, new product launches, new customer feedbacks, etc. are not predictable. Thus, the model needs to be retrained frequently. The company is looking for a solution that can automatically perform and help the analyst to get the insight from the unstructured data.</p><h1 id=image-clustering>Image Clustering<a hidden class=anchor aria-hidden=true href=#image-clustering>#</a></h1><p>Lets dive in the Technical side of the case study. There are multiple paradigms of supervised machine learning, such as classification, object detection, and segmentation, among others. There are many robust supervised algorithms; however, to achieve high accuracy, we need labeled data, which is costly and time-consuming. Clustering is an unsupervised learning technique that can be applied to unlabeled datasets. It is one of the most interesting and challenging problems in the field of computer vision. The goal of image clustering is to group similar images together in the same cluster. There are also other forms of machine learning, such as semi-supervised learning, reinforcement learning, and transfer learning, which are not covered in this article. The main goal of the article is to explore the image clustering technique beyond its traditional use cases.</p><h2 id=image-clustering--view-from-professional-settings>Image clustering: View from Professional settings<a hidden class=anchor aria-hidden=true href=#image-clustering--view-from-professional-settings>#</a></h2><p>In real world scenario, a company could ingest images from multiple sources. The image sizes / format , interest point in the image are unknown. To fetch the insight from the unstructure settings is really hard and requires alot of regular hand picked tuning. Thus, Many companies moves towards supervised learning where they sample the data and label them and train a supervised model to get the insight.</p><p>However, the unsupervised learning is also a good choice when the data is unpredictable and the labels are not available. The image clustering is one of the unsupervised learning technique which can be used to cluster the images based on the similarity and thus using this in the automated workflow to get the insight from the unstructured data.</p><h2 id=methodology>Methodology<a hidden class=anchor aria-hidden=true href=#methodology>#</a></h2><p>Image clustering systems can be divided into two main categories:</p><ol><li>Image feature Generation
Image pixels are stored as matrics in the computer. The size of image matrics varies based on the image size and format. Thus Image pixel couldnot be used directly to custering algorithm due to its size and variability.
Image features can be generated using various methods like neural networks, computer vision algorithms like SIFT, SURF, ORB, etc. Sometimes feature reduction techniques like PCA, LDA, etc are used to reduce the dimensionality of the features.</li><li>Feature clustering
After a feature is generated, the clustering algorithm is applied to the features to cluster the images. The clustering algorithm can be K-means, DBSCAN, Hierarchical clustering, etc.</li></ol><p>for the sake of this study, we are using a small dataset of brand logos. However in the study properitery e-commerce data [ logos from pdfs/ document ] are used. <img loading=lazy src=/images/logos.png alt=logos></p><p>Note: It really depends on the company data, sometimes the whole image are used to generate the features and sometimes the interest points are used to generate the features. Segment Anything model can be used to generate the interest points. Here, an invoice is parsed by the model when the text prompt is logo and the bounding box over the Tesla logo is generated.</p><p><img loading=lazy src=/images/segment_anything.png alt="Segment Anything"></p><p>Model Web Demo: <a href=https://huggingface.co/spaces/yizhangliu/Grounded-Segment-Anything>Segment Anything</a></p><h2 id=image-feature-generation>Image Feature Generation<a hidden class=anchor aria-hidden=true href=#image-feature-generation>#</a></h2><p>The latest trend of Attention based models outperforms the traditional computer vision algorithms. The attention based models like ViT, ResNet, EfficientNet, etc are used to generate the features. Likewise, there are multi model models like CLIP, DALL-E, etc which are used to generate the features. Using the multi model models, the features can be used to compared with the possible text data and thus can be used to generate the insight from the images.</p><p>for the example of the image clustering, we will be using the openAI&rsquo;s CLIP model to generate the features.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>from</span> <span class=nn>transformers</span> <span class=kn>import</span> <span class=n>AutoProcessor</span><span class=p>,</span> <span class=n>AutoTokenizer</span><span class=p>,</span> <span class=n>CLIPModel</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>model</span> <span class=o>=</span> <span class=n>CLIPModel</span><span class=o>.</span><span class=n>from_pretrained</span><span class=p>(</span><span class=s2>&#34;openai/clip-vit-large-patch14&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>processor</span> <span class=o>=</span> <span class=n>AutoProcessor</span><span class=o>.</span><span class=n>from_pretrained</span><span class=p>(</span><span class=s2>&#34;openai/clip-vit-large-patch14&#34;</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><p>a good alternative to the CLIP model is the VIT model.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>from</span> <span class=nn>transformers</span> <span class=kn>import</span> <span class=n>ViTImageProcessor</span><span class=p>,</span> <span class=n>ViTForImageClassification</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>processor</span> <span class=o>=</span> <span class=n>ViTImageProcessor</span><span class=o>.</span><span class=n>from_pretrained</span><span class=p>(</span><span class=s1>&#39;google/vit-base-patch16-224&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>model</span> <span class=o>=</span> <span class=n>ViTForImageClassification</span><span class=o>.</span><span class=n>from_pretrained</span><span class=p>(</span><span class=s1>&#39;google/vit-base-patch16-224&#39;</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><p>Resource to browse the models for feature generation: <a href="https://huggingface.co/models?pipeline_tag=image-classification&sort=downloads">Huggingface</a></p><p>Once the model is loaded, we can generate the features using the model.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=k>with</span> <span class=n>torch</span><span class=o>.</span><span class=n>no_grad</span><span class=p>():</span>
</span></span><span class=line><span class=cl>      <span class=n>inputs</span> <span class=o>=</span> <span class=n>processor</span><span class=p>(</span><span class=n>images</span><span class=o>=</span><span class=n>batch_images</span><span class=p>,</span> <span class=n>return_tensors</span><span class=o>=</span><span class=s2>&#34;pt&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>      <span class=n>image_feature_data</span> <span class=o>=</span> <span class=n>model</span><span class=o>.</span><span class=n>get_image_features</span><span class=p>(</span><span class=o>**</span><span class=n>inputs</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><p>It is important that the processor should be feed in the batch image data. since the the underlying model is trained on the batch image data. Thus batch image helps to achieve better throughput for generating the features.</p><h2 id=image-clustering-algorithm>Image clustering Algorithm<a hidden class=anchor aria-hidden=true href=#image-clustering-algorithm>#</a></h2><p>Once the features are generated, the clustering algorithm is applied to the features. The clustering algorithm can be K-means, DBSCAN, Hierarchical clustering, etc. Here, we choose Faiss for the clustering as it has both CPU and GPU support.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>import</span> <span class=nn>faiss</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>n_centroids</span> <span class=o>=</span> <span class=mi>5</span> <span class=c1># number of clusters</span>
</span></span><span class=line><span class=cl><span class=n>n_iter</span> <span class=o>=</span> <span class=mi>100</span> <span class=c1># number of iterations</span>
</span></span><span class=line><span class=cl><span class=n>verbose</span> <span class=o>=</span> <span class=kc>True</span>
</span></span><span class=line><span class=cl><span class=n>feature_data_dim</span> <span class=o>=</span> <span class=n>feature_data</span><span class=o>.</span><span class=n>shape</span><span class=p>[</span><span class=mi>1</span><span class=p>]</span> <span class=c1># dimension of the feature data</span>
</span></span><span class=line><span class=cl><span class=n>kmeans</span> <span class=o>=</span> <span class=n>faiss</span><span class=o>.</span><span class=n>Kmeans</span><span class=p>(</span><span class=n>feature_data_dim</span><span class=p>,</span> <span class=n>ncentroids</span><span class=p>,</span> <span class=n>niter</span><span class=o>=</span><span class=n>niter</span><span class=p>,</span> <span class=n>verbose</span><span class=o>=</span><span class=n>verbose</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>kmeans</span><span class=o>.</span><span class=n>train</span><span class=p>(</span><span class=n>feature_data</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><p>Lets see How it creates the cluster. <img loading=lazy src=/images/cluster_v1.png alt=cluster></p><p>The image clustering result doesnot make sense. lets update the hyperparamter and create the clustering again with different number of clusters.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>n_centroids</span> <span class=o>=</span> <span class=mi>35</span> <span class=c1># number of clusters</span>
</span></span></code></pre></td></tr></table></div></div><p>The clustering result is much better. <img loading=lazy src=/images/cluster_v2.png alt=cluster></p><p>The cluster result is better than the previous as we increased the number of clusters. The number of clusters can be determined based on the domain knowledge of the dataset or using the metrics.</p><h2 id=image-clustering-metrics>Image clustering Metrics<a hidden class=anchor aria-hidden=true href=#image-clustering-metrics>#</a></h2><p>Finding the best cluster size is a challengine task. The perfect cluster size can be predicted if some domain knowledge of the dataset is available. In the absence of domain knowledge, we can use the metrics to find the best cluster size.</p><p>Image clustering can be compared based on two types of metrics.</p><ol><li>Extrinsic metrics:
Extrinsic metrics are based on the ground truth labels. Some of the popular extrinsic metrics are:<ul><li>Adjusted Rand Index (ARI)</li><li>Normalized Mutual Information (NMI)</li><li>Fowlkes-Mallows Index (FMI)</li><li>Homogeneity, Completeness, and V-measure</li><li>Precision, Recall, and F1-score</li><li>Confusion matrix</li><li></li></ul></li></ol><p>However, we are into the unsupervised learning, we will not be using these metrics.</p><ol start=2><li>Intrinsic metrics:
Intrinsic metrics are based on the clustering results. Some of the popular intrinsic metrics are:<ul><li>Silhouette score</li><li>Davies-Bouldin Index</li><li>Calinski-Harabasz Index</li><li>Gap statistic</li><li>Elbow method</li></ul></li></ol><p>Lets see how we can use these metrics to evaluate the clustering results.</p><p>elbow method is used to find the best cluster size.</p><p><img loading=lazy src=/images/elbow.png alt=elbow></p><p>The elbow method is used to find the best cluster size. The best cluster size is the point where the curve starts to flatten. In the above image, the best cluster size is 35/40.</p><p>Similarly, other metrics can be used to evaluate the clustering results.</p><p>The blog only highlights the specfic part of the image clustering system. All the necessary code snippets are provided to get started with the image clustering. Many software enhancement and glue code are skipped for the sake of the article.</p><h1 id=result>Result<a hidden class=anchor aria-hidden=true href=#result>#</a></h1><p>A image clustering system is created and implemented in the system and the data is forwarded to the analyst for the further analysis. The system is able to cluster the data based on the cluster and thus necessary action can be taken much faster.
As the system is automated, many documents gets labelled eventually and thus labelling the cluster is much easier than labelling the whole dataset.</p></div><footer class=post-footer><ul class=post-tags><li><a href=https://shekharkoirala.github.io/tags/image/>Image</a></li><li><a href=https://shekharkoirala.github.io/tags/clustering/>Clustering</a></li><li><a href=https://shekharkoirala.github.io/tags/unsupervised/>Unsupervised</a></li><li><a href=https://shekharkoirala.github.io/tags/ml/>Ml</a></li></ul><ul class=share-buttons><li><a target=_blank rel="noopener noreferrer" aria-label="share Case study: Automated Image Clustering for E-commerce company on x" href="https://x.com/intent/tweet/?text=Case%20study%3a%20Automated%20Image%20Clustering%20for%20E-commerce%20company&amp;url=https%3a%2f%2fshekharkoirala.github.io%2fposts%2fimage_clustering_intro%2f&amp;hashtags=image%2cclustering%2cunsupervised%2cml"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M512 62.554V449.446C512 483.97 483.97 512 449.446 512H62.554C28.03 512 0 483.97.0 449.446V62.554C0 28.03 28.029.0 62.554.0H449.446C483.971.0 512 28.03 512 62.554zM269.951 190.75 182.567 75.216H56L207.216 272.95 63.9 436.783h61.366L235.9 310.383l96.667 126.4H456L298.367 228.367l134-153.151H371.033zM127.633 110h36.468l219.38 290.065H349.5z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share Case study: Automated Image Clustering for E-commerce company on linkedin" href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https%3a%2f%2fshekharkoirala.github.io%2fposts%2fimage_clustering_intro%2f&amp;title=Case%20study%3a%20Automated%20Image%20Clustering%20for%20E-commerce%20company&amp;summary=Case%20study%3a%20Automated%20Image%20Clustering%20for%20E-commerce%20company&amp;source=https%3a%2f%2fshekharkoirala.github.io%2fposts%2fimage_clustering_intro%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM160.461 423.278V197.561h-75.04v225.717h75.04zm270.539.0V293.839c0-69.333-37.018-101.586-86.381-101.586-39.804.0-57.634 21.891-67.617 37.266v-31.958h-75.021c.995 21.181.0 225.717.0 225.717h75.02V297.222c0-6.748.486-13.492 2.474-18.315 5.414-13.475 17.767-27.434 38.494-27.434 27.135.0 38.007 20.707 38.007 51.037v120.768H431zM123.448 88.722C97.774 88.722 81 105.601 81 127.724c0 21.658 16.264 39.002 41.455 39.002h.484c26.165.0 42.452-17.344 42.452-39.002-.485-22.092-16.241-38.954-41.943-39.002z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share Case study: Automated Image Clustering for E-commerce company on reddit" href="https://reddit.com/submit?url=https%3a%2f%2fshekharkoirala.github.io%2fposts%2fimage_clustering_intro%2f&title=Case%20study%3a%20Automated%20Image%20Clustering%20for%20E-commerce%20company"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM446 265.638c0-22.964-18.616-41.58-41.58-41.58-11.211.0-21.361 4.457-28.841 11.666-28.424-20.508-67.586-33.757-111.204-35.278l18.941-89.121 61.884 13.157c.756 15.734 13.642 28.29 29.56 28.29 16.407.0 29.706-13.299 29.706-29.701.0-16.403-13.299-29.702-29.706-29.702-11.666.0-21.657 6.792-26.515 16.578l-69.105-14.69c-1.922-.418-3.939-.042-5.585 1.036-1.658 1.073-2.811 2.761-3.224 4.686l-21.152 99.438c-44.258 1.228-84.046 14.494-112.837 35.232-7.468-7.164-17.589-11.591-28.757-11.591-22.965.0-41.585 18.616-41.585 41.58.0 16.896 10.095 31.41 24.568 37.918-.639 4.135-.99 8.328-.99 12.576.0 63.977 74.469 115.836 166.33 115.836s166.334-51.859 166.334-115.836c0-4.218-.347-8.387-.977-12.493 14.564-6.47 24.735-21.034 24.735-38.001zM326.526 373.831c-20.27 20.241-59.115 21.816-70.534 21.816-11.428.0-50.277-1.575-70.522-21.82-3.007-3.008-3.007-7.882.0-10.889 3.003-2.999 7.882-3.003 10.885.0 12.777 12.781 40.11 17.317 59.637 17.317 19.522.0 46.86-4.536 59.657-17.321 3.016-2.999 7.886-2.995 10.885.008 3.008 3.011 3.003 7.882-.008 10.889zm-5.23-48.781c-16.373.0-29.701-13.324-29.701-29.698.0-16.381 13.328-29.714 29.701-29.714 16.378.0 29.706 13.333 29.706 29.714.0 16.374-13.328 29.698-29.706 29.698zM160.91 295.348c0-16.381 13.328-29.71 29.714-29.71 16.369.0 29.689 13.329 29.689 29.71.0 16.373-13.32 29.693-29.689 29.693-16.386.0-29.714-13.32-29.714-29.693z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share Case study: Automated Image Clustering for E-commerce company on facebook" href="https://facebook.com/sharer/sharer.php?u=https%3a%2f%2fshekharkoirala.github.io%2fposts%2fimage_clustering_intro%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H342.978V319.085h66.6l12.672-82.621h-79.272v-53.617c0-22.603 11.073-44.636 46.58-44.636H425.6v-70.34s-32.71-5.582-63.982-5.582c-65.288.0-107.96 39.569-107.96 111.204v62.971h-72.573v82.621h72.573V512h-191.104c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share Case study: Automated Image Clustering for E-commerce company on whatsapp" href="https://api.whatsapp.com/send?text=Case%20study%3a%20Automated%20Image%20Clustering%20for%20E-commerce%20company%20-%20https%3a%2f%2fshekharkoirala.github.io%2fposts%2fimage_clustering_intro%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zm-58.673 127.703c-33.842-33.881-78.847-52.548-126.798-52.568-98.799.0-179.21 80.405-179.249 179.234-.013 31.593 8.241 62.428 23.927 89.612l-25.429 92.884 95.021-24.925c26.181 14.28 55.659 21.807 85.658 21.816h.074c98.789.0 179.206-80.413 179.247-179.243.018-47.895-18.61-92.93-52.451-126.81zM263.976 403.485h-.06c-26.734-.01-52.954-7.193-75.828-20.767l-5.441-3.229-56.386 14.792 15.05-54.977-3.542-5.637c-14.913-23.72-22.791-51.136-22.779-79.287.033-82.142 66.867-148.971 149.046-148.971 39.793.014 77.199 15.531 105.329 43.692 28.128 28.16 43.609 65.592 43.594 105.4-.034 82.149-66.866 148.983-148.983 148.984zm81.721-111.581c-4.479-2.242-26.499-13.075-30.604-14.571-4.105-1.495-7.091-2.241-10.077 2.241-2.986 4.483-11.569 14.572-14.182 17.562-2.612 2.988-5.225 3.364-9.703 1.12-4.479-2.241-18.91-6.97-36.017-22.23C231.8 264.15 222.81 249.484 220.198 245s-.279-6.908 1.963-9.14c2.016-2.007 4.48-5.232 6.719-7.847 2.24-2.615 2.986-4.484 4.479-7.472 1.493-2.99.747-5.604-.374-7.846-1.119-2.241-10.077-24.288-13.809-33.256-3.635-8.733-7.327-7.55-10.077-7.688-2.609-.13-5.598-.158-8.583-.158-2.986.0-7.839 1.121-11.944 5.604-4.105 4.484-15.675 15.32-15.675 37.364.0 22.046 16.048 43.342 18.287 46.332 2.24 2.99 31.582 48.227 76.511 67.627 10.685 4.615 19.028 7.371 25.533 9.434 10.728 3.41 20.492 2.929 28.209 1.775 8.605-1.285 26.499-10.833 30.231-21.295 3.732-10.464 3.732-19.431 2.612-21.298-1.119-1.869-4.105-2.99-8.583-5.232z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share Case study: Automated Image Clustering for E-commerce company on telegram" href="https://telegram.me/share/url?text=Case%20study%3a%20Automated%20Image%20Clustering%20for%20E-commerce%20company&amp;url=https%3a%2f%2fshekharkoirala.github.io%2fposts%2fimage_clustering_intro%2f"><svg viewBox="2 2 28 28" height="30" width="30" fill="currentcolor"><path d="M26.49 29.86H5.5a3.37 3.37.0 01-2.47-1 3.35 3.35.0 01-1-2.47V5.48A3.36 3.36.0 013 3 3.37 3.37.0 015.5 2h21A3.38 3.38.0 0129 3a3.36 3.36.0 011 2.46V26.37a3.35 3.35.0 01-1 2.47 3.38 3.38.0 01-2.51 1.02zm-5.38-6.71a.79.79.0 00.85-.66L24.73 9.24a.55.55.0 00-.18-.46.62.62.0 00-.41-.17q-.08.0-16.53 6.11a.59.59.0 00-.41.59.57.57.0 00.43.52l4 1.24 1.61 4.83a.62.62.0 00.63.43.56.56.0 00.4-.17L16.54 20l4.09 3A.9.9.0 0021.11 23.15zM13.8 20.71l-1.21-4q8.72-5.55 8.78-5.55c.15.0.23.0.23.16a.18.18.0 010 .06s-2.51 2.3-7.52 6.8z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share Case study: Automated Image Clustering for E-commerce company on ycombinator" href="https://news.ycombinator.com/submitlink?t=Case%20study%3a%20Automated%20Image%20Clustering%20for%20E-commerce%20company&u=https%3a%2f%2fshekharkoirala.github.io%2fposts%2fimage_clustering_intro%2f"><svg width="30" height="30" viewBox="0 0 512 512" fill="currentcolor" xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape"><path d="M449.446.0C483.971.0 512 28.03 512 62.554V449.446C512 483.97 483.97 512 449.446 512H62.554C28.03 512 0 483.97.0 449.446V62.554C0 28.03 28.029.0 62.554.0H449.446zM183.8767 87.9921h-62.034L230.6673 292.4508V424.0079h50.6655V292.4508L390.1575 87.9921H328.1233L256 238.2489z"/></svg></a></li></ul></footer></article></main><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>